{{ partial "header.html" . }}
{{ $url := (print (index .Site.Params.domainapi (getenv "NODE_ENV") | default .Site.Params.domainapi.dev) "/api/goal/" .Params.id ) }}

{{ $goal := getJSON $url }}

{{ with $goal.goal }}

<article role="main" id="conteudo" class="h-entry">
	<div class="h-entry__e-content e-content">
		<header>
			{{ if .badges }}
				<div class="badges">
					{{ range .badges }}
						<span data-tooltip="{{ .name }}">
							<img
								src="/assets/img/goal-badge-{{- .id -}}.png"
								alt="{{ .name }}"
								title="{{ .name }}"
							>
						</span>
					{{ end }}
				</div>
			{{ end }}
			<h2>
				{{ i18n "goal" 1 | lower }}
				{{ .id }}
			</h2>
			<h3>
				{{ i18n "topic" (len .topics) }}
				{{ range .topics }}
					{{ .name }}
				{{ end }}
			</h3>
			<h1 class="h-entry__p-name p-name">{{ trim .title "." }}</h1>
		</header>

		<section class="indicator">
			<p>{{ .indicator_description }}</p>
		</section>

		<section class="projection">
			<h2>{{ i18n "goalProjection" }}</h2>
			<dl>
				<div class="definition-item">
					<dt>2017 - 2018</dt>
					<dd>{{ .projection_first_biennium }}</dd>
				</div>
				<div class="definition-item">
					<dt>2019 - 2020</dt>
					<dd>{{ .projection_second_biennium }}</dd>
				</div>
			</dl>
		</section>

		{{ with .additional_information }}
			<section class="togglebox">
				<h2>{{ i18n "aditionalInfo" (len .) }}</h2>
				{{ range . }}
					<div class="togglebox__content">
						<time datetime="{{ .inserted_at }}">{{ dateFormat "02/01/2006" .inserted_at }}</time>
						<div class="text">
							{{ .description }}
						</div>
						<button class="read-more" data-js="togglebox-button">Ver mais</button>
					</div>
				{{ end }}
			</section>
		{{ end }}

		<section class="related-projects">
			<h2>{{ i18n "relatedProject" (len .) }}</h2>

			<dl>
			{{ range .projects }}
				<dt>
					{{ with .project.slug }}
						<a href="/projetos/{{ . }}">
					{{ end }}
						{{ .project.title }}
					{{ with .project.slug }}
						</a>
					{{ end }}
				</dt>
				<dd>{{ .project.description }}</dd>
			{{ end }}
			</dl>
		</section>

	</div>

	<aside>
		<section class="progress">
			{{ with .last_updated_at }}
				<h2>
					{{ i18n "lastUpdatedAt" }}:
					<span class="subtitle">{{ dateFormat "02/01/2006" . }}</span>
				</h2>
			{{ end }}

			{{ with .status }}
				<h2>
					{{ i18n "textStatus" }}:
					<span class="subtitle">{{ . }}</span>
				</h2>
			{{ end }}

			{{ with .execution }}
				<p>{{ i18n "textProgress" }}</p>

				<h2>{{ i18n "execution" }}</h2>

				<!-- Check if all .progress are null -->
				{{ $.Scratch.Set "hasProgressBar" false }}
				{{ range . }}
					{{ with .progress }}
						{{ $.Scratch.Set "hasProgressBar" true }}
					{{ end }}
				{{ end }}

				{{ if $.Scratch.Get "hasProgressBar"  }}
					<div role="progress" aria-valuemin="0" aria-valuemax="100">
						{{ range . }}
							<div
								role="progressbar"
								aria-valuenow="0"
								aria-valuemin="0"
								aria-valuemax="100"
								class="js-progress-hover progress-year-{{- .year }} progress-year--semester-{{- .semester -}}"
								data-more-info="{{ .progress }}% atingido no {{ .semester }}&ordm; semestre de {{ .year }}"
								style="width: {{- .progress -}}%">
							</div>
						{{ end }}
					</div>
					<div class="js-progress-more-info progress__more-info">
						<p></p>
					</div>
				{{ else }}

				{{ range sort . ".year" }}
					{{ with .base_value }}
						<p>{{ i18n "baseValue" }}: {{ . }}</p>
					{{ end }}
					{{ if isset . "accumulated" }}
						<p>
							{{ i18n "accumulated" }} {{ .semester }}ยบ {{ i18n "semesterAbbr" }} {{ .year }}: {{ .value }}
						</p>
					{{ end }}
				{{ end }}

				{{ end }}
			{{ end }}

			{{ if $.Scratch.Get "hasProgressBar"  }}
				<div class="progress-legend">
					<div class="progress-legend__year progress-legend__year--2017">
						<strong>2017</strong>
						<div class="progres-legend__line">
							<span class="progres-legend__year--color-first-semester"></span> {{ i18n "first_semester" }}
						</div>
						<div class="progres-legend__line">
							<span class="progres-legend__year--color-second-semester"></span> {{ i18n "second_semester" }}
						</div>
					</div>
					<div class="progress-legend__year progress-legend__year--2018">
						<strong>2018</strong>
						<div class="progres-legend__line">
							<span class="progres-legend__year--color-first-semester"></span> {{ i18n "first_semester" }}
						</div>
						<div class="progres-legend__line">
							<span class="progres-legend__year--color-second-semester"></span> {{ i18n "second_semester" }}
						</div>
					</div>
					<div class="progress-legend__year progress-legend__year--2019">
						<strong>2019</strong>
						<div class="progres-legend__line">
							<span class="progres-legend__year--color-first-semester"></span> {{ i18n "first_semester" }}
						</div>
						<div class="progres-legend__line">
							<span class="progres-legend__year--color-second-semester"></span> {{ i18n "second_semester" }}
						</div>
					</div>
					<div class="progress-legend__year progress-legend__year--2020">
						<strong>2020</strong>
						<div class="progres-legend__line">
							<span class="progres-legend__year--color-first-semester"></span> {{ i18n "first_semester" }}
						</div>
						<div class="progres-legend__line">
							<span class="progres-legend__year--color-second-semester"></span> {{ i18n "second_semester" }}
						</div>
					</div>
				</div>
			{{ end }}
		</section>

		{{ with .secretariats }}
			<section class="secretary">
				{{ range . }}
					<h2>
						{{ i18n "secretary_at" }}:
						<span class="subtitle">{{ .name }}</span>
					</h2>
				{{ end }}
			</section>
		{{ end }}

		<section class="districts">
			<h2>{{ i18n "benefitedSubprefectures" (len .) }}</h2>
			{{ if .subprefectures }}
				<ul class="district-list">
					{{ range .subprefectures }}
						<li>
							{{ with .slug }}
								<a href="/distritos/{{ . }}">
							{{ end }}
								{{ .name }}
							{{ with .slug }}
								</a>
							{{ end }}
						</li>
					{{ end }}
				</ul>
			{{ else }}
				<p class="warning">{{ i18n "dataNotRestrictedToARegion" }}</p>
			{{ end }}
			<div id="map" class="map"
				{{ if .subprefectures }}
					data-to-draw="subprefectures cities"
					data-subprefectures-to-draw="{{ range .subprefectures }}{{ .id }} {{ end }}"
				{{ else }}
					data-to-draw="cities"
					data-zoom="+1"
				{{ end }}
			></div>
		</section>
	</aside>

</article>

{{ end }}

{{ partialCached "footer.html" . }}
