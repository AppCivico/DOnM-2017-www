{{ partial "header.html" . }}
{{ $url := (print (index .Site.Params.domainapi (getenv "NODE_ENV") | default .Site.Params.domainapi.dev) "/api/action-line/" .Params.id ) }}

{{ $action_line := getJSON $url }}

{{ with $action_line.action_line }}

<article role="main" id="conteudo" class="h-entry">
	<div class="h-entry__e-content e-content">
		<header>
			<h2>
				{{ i18n "actionLine" 1 }}
				{{ .id }}
			</h2>

			<h3>
				{{ i18n "topic" 1 | lower }} {{ .topic.name }}
			</h3>

			<h1 class="h-entry__p-name p-name">{{ trim .title "." }}</h1>
		</header>

		<section class="map-container">
			<h2>{{ i18n "regionalizationMap" }}</h2>
			{{ if not .subprefectures }}
				<p class="warning">{{ i18n "dataNotRestrictedToARegion" }}</p>
			{{ end }}
			<div id="map" class="map"
				{{ if .subprefectures }}
					data-link-for="subprefectures" data-info-panel-for="subprefectures" data-info-panel-for-subprefectures="info-panel__subprefectures--indicator" data-to-draw="subprefectures" data-subprefectures-to-draw="{{ range .subprefectures }}{{ .id }} {{ end }}"
					data-subprefectures-distribute-by="indicator"
				{{ else }}
					data-to-draw="cities"
				{{ end }}
			></div>
		</section>

		{{ if .subprefectures }}
			<section class="projection">
				<h2>{{ i18n "regionalization" }}</h2>
				<table>
					<thead>
						<tr>
							<th>{{ i18n "regionalPrefecture" (len .) | title }}</th>
							<th>{{ i18n "value" | title }} 2017-2020</th>
						</tr>

					</thead>

					<tbody>
						{{ range .subprefectures }}
						<tr>
							<td>
								{{ with .slug }}
									<a href="/prefeituras-regionais/{{ . }}">
								{{ end }}
									{{ .name }}
								{{ with .slug }}
									</a>
								{{ end }}
							</td>

							<td>
								{{ .indicator }}
							</td>
						</tr>
						{{ end }}
					</tbody>
				</table>
				<script>
					var customDistribution = customDistribution || {};

					customDistribution.indicator = {
						{{ range .subprefectures }}
							{{ .id }}: "{{ .indicator }}",
						{{ end }}
					};
				</script>

				<script type="text/template" id="info-panel__subprefectures--indicator">
					<dl>
						<dt>{{ i18n "regionalPrefecture" 1 }}</dt>
						<dd data-to-bind="name">&mdash;</dd>
						<dt>{{ i18n "indicator"  }}</dt>
						<dd class="custom-info-panel__counter" data-to-bind="indicator">0</dd>
					</dl>
				</script>

			</section>
		{{ end }}
	</div>

	<aside>
		<section class="secretaries">
			<h2>{{ i18n "secretary" (len $action_line.action_line) }}</h2>
			<ul class="district-list">
				{{ range .action_lines }}
					<li>
						{{ with .slug }}
							<a href="/linhas-de-acao/{{ . }}">
						{{ end }}
							{{ .name }}
						{{ with .slug }}
							</a>
						{{ end }}
					</li>
				{{ end }}
			</ul>
		</section>

		<section class="progress">
			<p>{{ i18n "textProgress" }}</p>

			<progress {{ with .progress }}value="{{ . }}"{{ end }} max="100">
				<div class="progress-bar">
					<span {{ with .progress }} style="width: {{ . }}%;" {{ end }}>
						{{ with .progress }}{{ . }}%{{ end }}
					</span>
				</div>
			</progress>
		</section>

		<section class="related-projects">
			<h2>{{ i18n "relatedProject" (len $action_line.action_line) }}</h2>

			<dl>
			{{ range .projects }}
				<dt>
					{{ with .slug }}
						<a href="/projetos/{{ . }}">
					{{ end }}
						{{ .title }}
					{{ with .slug }}
						</a>
					{{ end }}
				</dt>
				<dd>{{ .description }}</dd>
			{{ end }}
			</dl>
		</section>

	</aside>

</article>

{{ end }}

{{ partialCached "footer.html" . }}
